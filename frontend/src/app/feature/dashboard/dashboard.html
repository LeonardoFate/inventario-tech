<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Dashboard - Sistema de Inventario</h1>
    <p *ngIf="usuario">Bienvenido, {{ usuario.nombres }} {{ usuario.apellidos }} ({{ usuario.rol }})</p>
  </div>

  <!-- Panel de Debug (Opcional - puedes removerlo después) -->
  <div class="debug-panel" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
    <details>
      <summary style="cursor: pointer; font-weight: bold; margin-bottom: 10px;">🔧 Panel de Debug (Click para expandir)</summary>
      <div style="font-family: monospace; font-size: 12px;">
        <div><strong>Estado:</strong>
          <span *ngIf="loading" style="color: orange;">🔄 Cargando</span>
          <span *ngIf="!loading && estadisticas" style="color: green;">✅ Datos Cargados</span>
          <span *ngIf="!loading && error" style="color: red;">❌ Error</span>
        </div>
        <div><strong>Total Dispositivos:</strong> {{ estadisticas?.general?.TotalDispositivos || 'N/A' }}</div>
        <button (click)="cargarEstadisticas()" class="btn btn-sm btn-secondary" style="margin-top: 10px;">🔄 Recargar</button>
      </div>
    </details>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading">
    <div style="font-size: 24px;">🔄</div>
    <p>Cargando estadísticas...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error">
    <h3>❌ Error</h3>
    <p>{{ error }}</p>
    <button (click)="cargarEstadisticas()" class="btn btn-danger">🔄 Reintentar</button>
  </div>

  <!-- Success State - Dashboard Content -->
  <div *ngIf="estadisticas && !loading && !error" class="dashboard-content">

    <!-- Tarjetas de resumen -->
    <div class="stats-grid">
      <div class="stat-card total">
        <h3>Total Dispositivos</h3>
        <p class="stat-number">{{ estadisticas.general.TotalDispositivos || 0 }}</p>
      </div>
      
      <div class="stat-card disponible">
        <h3>Disponibles</h3>
        <p class="stat-number">{{ estadisticas.general.Disponibles || 0 }}</p>
      </div>
      
      <div class="stat-card asignado">
        <h3>Asignados</h3>
        <p class="stat-number">{{ estadisticas.general.Asignados || 0 }}</p>
      </div>
      
      <div class="stat-card reparacion">
        <h3>En Reparación</h3>
        <p class="stat-number">{{ estadisticas.general.EnReparacion || 0 }}</p>
      </div>
    </div>

    <!-- Valor del inventario -->
    <div class="valor-inventario" *ngIf="estadisticas.general.ValorTotalInventario && estadisticas.general.ValorTotalInventario > 0">
      <h3>Valor Total del Inventario</h3>
      <p class="valor-total">${{ estadisticas.general.ValorTotalInventario | number:'1.2-2' }}</p>
    </div>

    <!-- Accesos rápidos -->
    <div class="quick-actions">
      <h3>Accesos Rápidos</h3>
      <div class="actions-grid">
        <a routerLink="/dispositivos" class="action-card">
          <h4>📱 Ver Dispositivos</h4>
          <p>Gestionar inventario</p>
        </a>
        
        <a routerLink="/dispositivos" [queryParams]="{estado: 'Disponible'}" class="action-card">
          <h4>✅ Dispositivos Disponibles</h4>
          <p>{{ estadisticas.general.Disponibles || 0 }} disponibles</p>
        </a>
        
        <a *ngIf="usuario?.rol === 'Administrador'" routerLink="/categorias" class="action-card">
          <h4>📋 Gestionar Catálogos</h4>
          <p>Categorías, marcas, ubicaciones</p>
        </a>
        
        <a *ngIf="estadisticas.general.TotalDispositivos === 0" routerLink="/dispositivos" class="action-card">
          <h4>➕ Agregar Dispositivos</h4>
          <p>Comenzar a registrar equipo</p>
        </a>
      </div>
    </div>

    <!-- Distribución por categoría -->
    <div class="categoria-chart" *ngIf="estadisticas.porCategoria && estadisticas.porCategoria.length > 0">
      <h3>Dispositivos por Categoría</h3>
      <div class="chart-items">
        <div *ngFor="let item of estadisticas.porCategoria" class="chart-item">
          <span class="categoria-nombre">{{ item.NombreCategoria }}</span>
          <span class="categoria-cantidad">{{ item.Cantidad }}</span>
        </div>
      </div>
    </div>

    <!-- Distribución por marca (top 5) -->
    <div class="marca-chart" *ngIf="estadisticas.porMarca && estadisticas.porMarca.length > 0">
      <h3>Principales Marcas</h3>
      <div class="chart-items">
        <div *ngFor="let item of estadisticas.porMarca.slice(0, 5)" class="chart-item">
          <span class="categoria-nombre">{{ item.NombreMarca }}</span>
          <span class="categoria-cantidad">{{ item.Cantidad }}</span>
        </div>
      </div>
    </div>

    <!-- Distribución por ubicación -->
    <div class="ubicacion-chart" *ngIf="estadisticas.porUbicacion && estadisticas.porUbicacion.length > 0">
      <h3>Dispositivos por Ubicación</h3>
      <div class="chart-items">
        <div *ngFor="let item of estadisticas.porUbicacion" class="chart-item">
          <span class="categoria-nombre">{{ item.NombreUbicacion }}</span>
          <span class="categoria-cantidad">{{ item.Cantidad }}</span>
        </div>
      </div>
    </div>

    <!-- Mensaje si inventario está vacío -->
    <div *ngIf="estadisticas.general.TotalDispositivos === 0" class="no-data-message">
      <h3>📦 Inventario Vacío</h3>
      <p>No hay dispositivos registrados en el sistema.</p>
      <a routerLink="/dispositivos" class="btn btn-primary">➕ Agregar Primer Dispositivo</a>
    </div>

    <!-- Alertas importantes - Solo si hay dispositivos -->
    <div class="alerts-section" *ngIf="estadisticas.general && estadisticas.general.TotalDispositivos > 0">
      <h3>⚠️ Alertas</h3>
      <div class="alerts-grid">
        
        <div *ngIf="estadisticas.general.GarantiaVencida && estadisticas.general.GarantiaVencida > 0" class="alert alert-danger">
          <h4>🔴 Garantías Vencidas</h4>
          <p>{{ estadisticas.general.GarantiaVencida }} dispositivos con garantía vencida</p>
        </div>
        
        <div *ngIf="estadisticas.general.GarantiaPorVencer && estadisticas.general.GarantiaPorVencer > 0" class="alert alert-warning">
          <h4>🟡 Garantías por Vencer</h4>
          <p>{{ estadisticas.general.GarantiaPorVencer }} dispositivos con garantía próxima a vencer</p>
        </div>
        
        <div *ngIf="estadisticas.general.Perdidos && estadisticas.general.Perdidos > 0" class="alert alert-danger">
          <h4>🔴 Equipos Perdidos</h4>
          <p>{{ estadisticas.general.Perdidos }} dispositivos reportados como perdidos</p>
        </div>
        
        <div *ngIf="estadisticas.general.EnReparacion && estadisticas.general.EnReparacion > 0" class="alert alert-info">
          <h4>🔧 En Reparación</h4>
          <p>{{ estadisticas.general.EnReparacion }} dispositivos en servicio técnico</p>
        </div>

        <!-- Mensaje si no hay alertas -->
        <div *ngIf="(!estadisticas.general.GarantiaVencida || estadisticas.general.GarantiaVencida === 0) && 
                    (!estadisticas.general.GarantiaPorVencer || estadisticas.general.GarantiaPorVencer === 0) && 
                    (!estadisticas.general.Perdidos || estadisticas.general.Perdidos === 0) && 
                    (!estadisticas.general.EnReparacion || estadisticas.general.EnReparacion === 0)" 
             class="alert alert-success">
          <h4>✅ Todo en Orden</h4>
          <p>No hay alertas pendientes en el inventario</p>
        </div>
        
      </div>
    </div>
  </div>

  <!-- State: No estadísticas pero sin error -->
  <div *ngIf="!loading && !error && !estadisticas" class="no-stats">
    <h3>⚠️ Sin Estadísticas</h3>
    <p>Las estadísticas no se cargaron correctamente.</p>
    <button (click)="cargarEstadisticas()" class="btn btn-warning">🔄 Intentar de Nuevo</button>
  </div>
</div>